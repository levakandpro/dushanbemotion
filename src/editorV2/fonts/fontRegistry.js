// === DM EDITOR V2 - AUTO FONT REGISTRY ===

// –ë–∞–∑–æ–≤—ã–π URL –¥–ª—è —à—Ä–∏—Ñ—Ç–æ–≤ (–ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏, r2.dev)
// –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—á–µ–≥–æ URL: https://pub-cd4220c7fb604875a5686b61f0d13f02.r2.dev/fonts/0_BlackerSansProVariableGX.ttf
const FONTS_BASE_URL = "https://pub-cd4220c7fb604875a5686b61f0d13f02.r2.dev/fonts";

// –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –ø—Ä–∏—Å–ª–∞–ª
const FILES = [
"0_BlackerSansProVariableGX.ttf",
"1_BlackerSansProItVariableGX.ttf",
"Adventure_Indiana_Jones.ttf",
"amrys-black-italic.otf",
"amrys-black.otf",
"amrys-semi-bold-italic.otf",
"amrys-semi-bold.otf",
"Andy MT Cyrillic Bold_0.otf",
"Aquiline.ttf",
"ArchiveUkr.ttf",
"Arctika Script.otf",
"Arial Rounded MT + Helvetica.ttf",
"Arial Rounded MT_300 + Helvetica.ttf",
"Arial Rounded MT_700 + Helvetica.ttf",
"ArialBlackPrimer.ttf",
"AsiaAS-Normal.ttf",
"BASEBLOOM-Regular.ttf",
"Belepotan Rus Italic.otf",
"Belepotan Rus.otf",
"Berton-Roman-trial.ttf",
"berton-roman.ttf",
"Berton-Voyage-trial.ttf",
"berton-voyage.ttf",
"Betmo Regular Cyr.otf",
"Bistroc.otf",
"BulbasaurSP.otf",
"Candice Cyr Regular.ttf",
"CCSpellcaster Bold Italic.ttf",
"CCSpellcaster Bold.ttf",
"CCSpellcaster Italic.ttf",
"CCSpellcaster Regular.ttf",
"CCZoinks Inline.ttf",
"CCZoinks Outline.ttf",
"CCZoinks Regular.ttf",
"century_gothic__xara_edit__font_by_104godiego_djuj1h9.ttf",
"Christmas On Crack.otf",
"Coffee Bear.otf",
"Compacta LT Black P.otf",
"Compacta LT Light Compress.otf",
"Crackhouse Cyr (sherbackoffalex).otf",
"Crackhouse.ttf",
"Daneehand Regular Cyr.ttf",
"DearType - Lifehack Basic.otf",
"DearType - Lifehack Bold.otf",
"DearType - Lifehack Goodies.otf",
"DearType - Lifehack Italic Bold.otf",
"DearType - Lifehack Italic Medium.otf",
"DearType - Lifehack Italic.otf",
"DearType - Lifehack Medium.otf",
"DearType - Lifehack Sans Bold.otf",
"DearType - Lifehack Sans Medium.otf",
"DearType - Lifehack Sans.otf",
"DearType - Lifehack.otf",
"dehinted-DarumadropOne.ttf",
"dehinted-GillSansNova-ExtraCondBold.ttf",
"dehinted-HandveticaNeue-Regular.ttf",
"Derby Regular.otf",
"Derby Shadow.ttf",
"Deutsch Gothic Regular.otf",
"DIST Inking.ttf",
"DKCinnabarBrush-Regular.ttf",
"EternaBreaks-Regular_0.ttf",
"Etude Noire Bold.ttf",
"Etude Noire Light.ttf",
"Etude Noire Medium.ttf",
"Etude Noire Regular.ttf",
"FalknerPro.otf",
"farang_0.ttf",
"FasolSPDemo.otf",
"Forksa-Regular.ttf",
"Freestyle Script  (sherbackoffalex kerning).otf",
"Freestyle Script Bold  RUS.otf",
"Freestyle Script Bold.otf",
"Freestyle Script ITC Bold.otf",
"Freestyle Script ITC Regular.otf",
"Freestyle Script Plain.otf",
"fs-picto.ttf",
"Fyl-Regular.ttf",
"Fyl-Rotated.ttf",
"gergel_font.otf",
"gnyrwn971.ttf",
"gnyrwn977.otf",
"Guano Apes (Rus by sherbackoffalex).otf",
"Hamiltone1.otf",
"Hello_January_script_cyrillic_Script.otf",
"HelveticaInseratLTPro.otf",
"Hombre Bold Italic.otf",
"Hombre Bold.otf",
"Hombre Italic.otf",
"Hombre Regular.otf",
"Homer Simpson.ttf",
"HowToBasicDisplay-Bold.ttf",
"HowToBasicDisplay-BoldItalic.ttf",
"hummus.ttf",
"HUNoodles-Bold.otf",
"HYWenHei.ttf",
"Improv ICG.otf",
"InsurgentPro_0.ttf",
"Ithaka Bold_0.otf",
"ithaka-regular_0.otf",
"Izvod.otf",
"JacobyICGBlackCyrillic-Regular[1].otf",
"jaipur.ttf",
"jeM.otf",
"Jun_Italic.otf",
"Jun_Regular.otf",
"KaaosPro.ttf",
"Karlson Regular.ttf",
"Karton-Regular.ttf",
"Kids52-Regular.otf",
"Kontrabanda.ttf",
"kraM.ttf",
"KvitkaSPDemo.otf",
"LaborUnion-Regular.otf",
"Lady Marmalade.otf",
"LeOsler-RoughBorderRegular.ttf",
"LeOsler-RoughIconRegular.ttf",
"LeOsler-RoughShadowRegular.ttf",
"LeOsler-SharpRegular.ttf",
"LeOsler-StampLight.ttf",
"Letov.ttf",
"LincolnElectric-Over.ttf",
"LincolnElectric-Regular.ttf",
"LincolnElectric-Under.ttf",
"Loreley Antiqua.ttf",
"Lubalin Graph ITC Turner Bold.otf",
"MakanHatiCyrillic.otf",
"Manege-Light.ttf",
"MotivationOfHearts.ttf",
"Mr_Lonely.otf",
"MTSCompact-Bold-LBQB3WRX.ttf",
"MTSCompact-Medium-Y4SPBQKE.ttf",
"MTSCompact-Regular-7LG3MIHS.ttf",
"MTSWide-Bold-XQ34CV62.ttf",
"MTSWide-Medium-MH5A5AEJ.ttf",
"Neue Helvetica Pro 69 Compressed Medium.otf",
"ofont.ru_LeoHand.ttf",
"Ogonyok-Regular_bold_plus.ttf.otf",
"Onmark TRIAL Regular.otf",
"PaluiSPDemo-Bold.otf",
"Papyrus-02.otf",
"PassionsConflictRUS-Regular.otf",
"PLBehemoth-SemiCondensed.otf",
"podarok.ttf",
"PowerStationSolidRus-Regular.ttf",
"Renju.otf",
"Roadkill Heavy Regular.otf",
"Rookie Punk (–°orrected).otf",
"RookiePunk.ttf",
"Schist Black.ttf",
"Schist Bold.ttf",
"Schist Light.ttf",
"Schist Regular.ttf",
"Scrawl Regular_0.ttf",
"ShagCyrillic-Lounge.ttf",
"Slavic-Regular.ttf",
"ST-Warmovie-noncommercial.otf",
"ST-Warmovie-noncommercial.ttf",
"stencilbtrusbyme[1].otf",
"StieglitzSP-Bold 2.otf",
"TagesschriftCyrillic-Regular.ttf",
"tilda-script-bold.otf",
"tilda-script-non-connect-bold.otf",
"tilda-script-semi-bold.otf",
"tildascript-regular.otf",
"TsvikSPDemo.otf",
"UD Digi Kyokasho NP-B.ttf",
"UnifixSPDemo.otf",
"Veles Redone (sherbackoffalex).otf",
"Vertiger.otf",
"WaltoNeue-Italic.ttf",
"WaltoNeue-Regular.ttf",
"Waterway Display Font.ttf",
"Widock TRIAL Bold.otf",
"Wild-Rune.otf",
"xbox.otf",
"XPLOR_Bold-Regular.otf",
"YDKJ_The_Ride2_0.ttf",
"ZenterSPDemo-Black.otf",
"zh-cn.ttf",
"–ü—å—è–Ω—ã–π –ê–ª—Ñ–∞–≤–∏—Ç.ttf",
"—à—Ä–∏—Ñ—Ç 1_0.otf"
];

// –ê–≤—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
const generateFontData = (file, index) => {
  const clean = file.replace(/\.(ttf|otf)$/i, "");
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π id, –¥–æ–±–∞–≤–ª—è—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –¥–ª—è —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∏–º–µ–Ω
  const extension = file.match(/\.(ttf|otf)$/i)?.[1] || '';
  const baseId = clean.replace(/[^a-zA-Z0-9_]/g, "_");
  // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫ id –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ST_Warmovie_noncommercial_otf –∏ ST_Warmovie_noncommercial_ttf)
  const uniqueId = extension ? `${baseId}_${extension.toLowerCase()}` : `${baseId}_${index}`;
  // –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∫–æ–¥–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è URL (–ø—Ä–æ–±–µ–ª—ã, —Å–∫–æ–±–∫–∏, –ø–ª—é—Å –∏ —Ç.–¥.)
  const encodedFile = encodeURIComponent(file);

  return {
    id: uniqueId,
    family: clean,
    weight: "400",
    style: "normal",
    file,
    url: `${FONTS_BASE_URL}/${encodedFile}` // –ü—Ä—è–º–æ–π URL –¥–æ —Ñ–∞–π–ª–∞ —à—Ä–∏—Ñ—Ç–∞ —Å URL-—ç–Ω–∫–æ–¥–∏–Ω–≥–æ–º
  };
};

export const DM_FONTS = FILES.map((file, index) => generateFontData(file, index));

export const getFontById = (id) => DM_FONTS.find(f => f.id === id);
// –î–µ—Ñ–æ–ª—Ç–Ω—ã–π —à—Ä–∏—Ñ—Ç - MTSWide-Medium-MH5A5AEJ (–µ—Å–ª–∏ –µ—Å—Ç—å), –∏–Ω–∞—á–µ –ø–µ—Ä–≤—ã–π
export const getDefaultFont = () => {
  const preferred = DM_FONTS.find(f => f.family === 'MTSWide-Medium-MH5A5AEJ');
  return preferred || DM_FONTS[0];
};

// –ö—ç—à –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤
const loadedFonts = new Set();

export const ensureFontFaceLoaded = async (fontId) => {
  const font = getFontById(fontId);
  if (!font) {
    console.warn(`Font not found: ${fontId}`);
    return;
  }

  // –ï—Å–ª–∏ —à—Ä–∏—Ñ—Ç —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–Ω–æ–≤–∞
  if (loadedFonts.has(fontId)) {
    return;
  }

  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π URL –¥–æ —Ñ–∞–π–ª–∞ —à—Ä–∏—Ñ—Ç–∞ (—Å —ç–Ω–∫–æ–¥–∏–Ω–≥–æ–º)
  const url = font.url || `${FONTS_BASE_URL}/${encodeURIComponent(font.file)}`;
  const lowerFile = font.file.toLowerCase();
  const format = lowerFile.endsWith('.otf') ? 'opentype' : 'truetype';
  
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º CSS @font-face –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–µ–±-—à—Ä–∏—Ñ—Ç–∞
  const styleId = `font-face-${fontId}`;
  if (document.getElementById(styleId)) {
    loadedFonts.add(fontId);
    return;
  }

  try {
    // –°–æ–∑–¥–∞–µ–º @font-face —á–µ—Ä–µ–∑ CSS - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–µ–±-—à—Ä–∏—Ñ—Ç–æ–≤
    const style = document.createElement('style');
    style.id = styleId;
    
    // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –∏–º—è —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è CSS (—ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º –∫–∞–≤—ã—á–∫–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã)
    const safeFamily = font.family
      .replace(/\\/g, '\\\\')  // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–ª–µ—à–∏
      .replace(/'/g, "\\'")   // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏
      .replace(/"/g, '\\"');  // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏
    
    console.log(`üìù Loading font: ${font.family} (${fontId}) from ${url}`);
    
    // –ü–æ–¥–∫–ª—é—á–∞–µ–º —à—Ä–∏—Ñ—Ç –∫–∞–∫ –≤–µ–±-—à—Ä–∏—Ñ—Ç —á–µ—Ä–µ–∑ @font-face
    style.textContent = `
      @font-face {
        font-family: '${safeFamily}';
        src: url('${url}') format('${format}');
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }
    `;
    
    document.head.appendChild(style);
    loadedFonts.add(fontId);
    
    console.log(`‚úÖ Font loaded: ${font.family} (${fontId})`);
  } catch (error) {
    console.error(`‚ùå Failed to load font ${font.family} (${fontId}):`, error);
    // –ù–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ loadedFonts, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
  }
};

export default DM_FONTS;
