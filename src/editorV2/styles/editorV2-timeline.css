/* =============================================
   АУДИО-ТАЙМЛАЙН (УПРОЩЁННЫЙ)
   ============================================= */

.audio-timeline {
  width: 100%;
  background: var(--dm-timeline-bg);
  border-top: 1px solid rgba(44, 94, 78, 0.2);
  position: relative;
  z-index: 5;
  padding: 0;
}

.audio-timeline-simple {
  width: 100%;
}

/* ============================================= 
   СВЁРНУТЫЙ РЕЖИМ
   ============================================= */

.audio-timeline-collapsed {
  padding: 10px 20px;
  border-top: 1px solid rgba(44, 94, 78, 0.25);
}

.timeline-collapsed-header {
  display: flex;
  align-items: center;
  gap: 20px;
  justify-content: space-between;
  max-width: 100%;
}

.timeline-expand-btn {
  background: rgba(44, 94, 78, 0.15);
  border: 1px solid rgba(44, 94, 78, 0.3);
  color: #fff;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 600;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
  white-space: nowrap;
}

.timeline-expand-btn:hover {
  background: rgba(44, 94, 78, 0.25);
  border-color: rgba(44, 94, 78, 0.5);
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(44, 94, 78, 0.3);
}

.timeline-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  vertical-align: middle;
  flex-shrink: 0;
  color: currentColor;
}

.timeline-collapsed-info {
  display: flex;
  gap: 16px;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.65);
  align-items: center;
}

.timeline-collapsed-info span {
  padding: 4px 10px;
  background: rgba(44, 94, 78, 0.12);
  border-radius: 6px;
  border: 1px solid rgba(44, 94, 78, 0.25);
  font-weight: 600;
  font-size: 11px;
}

.timeline-playback-mini {
  display: flex;
  align-items: center;
  gap: 8px;
}

.timeline-play-btn {
  background: linear-gradient(135deg, rgba(44, 94, 78, 0.25), rgba(92, 255, 212, 0.2));
  border: 1.5px solid rgba(44, 94, 78, 0.4);
  color: #fff;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(44, 94, 78, 0.15);
}

.timeline-play-btn:hover {
  background: linear-gradient(135deg, rgba(44, 94, 78, 0.35), rgba(92, 255, 212, 0.3));
  border-color: rgba(44, 94, 78, 0.6);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(44, 94, 78, 0.3);
}

.timeline-play-btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 6px rgba(44, 94, 78, 0.2);
}

.timeline-time-display {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.85);
  font-variant-numeric: tabular-nums;
  font-weight: 600;
  background: rgba(44, 94, 78, 0.1);
  padding: 4px 10px;
  border-radius: 6px;
  border: 1px solid rgba(44, 94, 78, 0.2);
  font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
}

/* ============================================= 
   РАЗВЁРНУТЫЙ РЕЖИМ
   ============================================= */

.audio-timeline-expanded {
  padding: 0;
  max-height: 400px;
  display: flex;
  flex-direction: column;
}

/* ============================================= 
   ШАПКА ТАЙМЛАЙНА - УДАЛЕНА
   ============================================= */

/* Все стили шапки закомментированы, так как управление перенесено в боковую панель */

/* Кнопки перенесены в боковую панель - стили удалены */

/* ============================================= 
   ОСНОВНАЯ ОБЛАСТЬ
   ============================================= */

.timeline-main {
  display: flex;
  flex: 1;
  min-height: 0;
  position: relative;
}

.timeline-track-area {
  flex: 1;
  overflow-x: hidden;
  overflow-y: hidden;
  position: relative;
  background: rgba(0, 0, 0, 0.2);
  user-select: none;
}

.timeline-content-wrapper {
  position: relative;
  width: 100%;
  height: 100%;
}

/* Структура с фиксированной левой колонкой и скроллируемой областью дорожек */
.timeline-tracks-layout {
  display: flex;
  position: relative;
  width: 100%;
  height: calc(100% - 20px); /* Вычитаем высоту TimeRuler */
  overflow: hidden;
}

/* Фиксированная левая колонка с лейблами */
.timeline-labels-column {
  flex-shrink: 0;
  width: 76px; /* Ширина лейблов */
  min-width: 76px;
  max-width: 76px;
  position: relative;
  z-index: 10;
  background: rgba(0, 0, 0, 0.3);
  overflow: hidden; /* Левая колонка не скроллится */
}

/* Скроллируемая область с дорожками */
.timeline-tracks {
  flex: 1;
  overflow-x: auto; /* Разрешаем горизонтальный скролл */
  overflow-y: hidden;
  position: relative;
  background: rgba(0, 0, 0, 0.2);
  user-select: none;
  /* Стилизованный тонкий скроллбар */
  scrollbar-width: thin; /* Firefox */
  scrollbar-color: rgba(44, 94, 78, 0.6) rgba(0, 0, 0, 0.3); /* Firefox: бегунок и трек */
}

/* Webkit (Chrome/Safari/Opera) - стилизация скроллбара */
.timeline-tracks::-webkit-scrollbar {
  height: 8px; /* Тонкий скроллбар */
}

.timeline-tracks::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}

.timeline-tracks::-webkit-scrollbar-thumb {
  background: rgba(44, 94, 78, 0.6);
  border-radius: 4px;
  transition: background 0.2s;
}

.timeline-tracks::-webkit-scrollbar-thumb:hover {
  background: rgba(44, 94, 78, 0.8);
}

.timeline-tracks::-webkit-scrollbar-thumb:active {
  background: rgba(92, 255, 212, 0.5);
}

/* Контейнер с содержимым дорожек */
.timeline-tracks-content {
  position: relative;
  height: 100%;
  /* min-width убран - ширина задается через inline style в AudioTimeline.jsx */
}

/* Убеждаемся, что дорожки в левой колонке не имеют контента */
.timeline-labels-column .audio-track {
  display: flex;
  align-items: stretch;
  height: 32px;
  min-height: 32px;
  max-height: 32px;
}

.timeline-labels-column .audio-track-thin {
  height: 24px;
  min-height: 24px;
  max-height: 24px;
}

.timeline-labels-column .audio-track-content {
  display: none !important; /* Скрываем контент в левой колонке */
}

.timeline-labels-column .audio-track-label {
  width: 100% !important;
  min-width: 100% !important;
  max-width: 100% !important;
}

/* Синхронизация высоты дорожек в правой области */
.timeline-tracks-content .audio-track {
  height: 32px;
  min-height: 32px;
  max-height: 32px;
}

.timeline-tracks-content .audio-track-thin {
  height: 24px;
  min-height: 24px;
  max-height: 24px;
}

.timeline-tracks-content .timeline-group-track {
  min-height: 32px;
}

/* ============================================= 
   ЛИНЕЙКА ВРЕМЕНИ
   ============================================= */

.time-ruler {
  height: 20px;
  min-height: 20px;
  max-height: 20px;
  position: relative;
  background: linear-gradient(180deg, var(--dm-timeline-bg) 0%, rgba(7, 23, 17, 0.9) 100%);
  border-bottom: 1px solid rgba(255, 255, 255, 0.05); /* тонкий разделитель */
  cursor: pointer;
  user-select: none;
  box-shadow: none;
  min-width: 100%;
  overflow: visible;
}

.time-marker {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 4px;
}

.time-marker-line {
  width: 1px;
}

/* Major метки (с подписями) */
.time-marker-major .time-marker-line {
  height: 8px;
  background: rgba(223, 254, 243, 0.25); /* низкая opacity для compact mode */
}

/* Minor метки (без подписей) */
.time-marker-minor .time-marker-line {
  height: 4px;
  background: rgba(223, 254, 243, 0.15);
}

.time-marker-label {
  font-size: 8px;
  color: rgba(223, 254, 243, 0.55);
  margin-top: 0;
  padding-left: 0;
  font-variant-numeric: tabular-nums;
  text-shadow: none;
  font-weight: 500;
  line-height: 1;
}

.playhead {
  position: absolute;
  top: 0;
  height: 100%;
  pointer-events: none;
  z-index: 100;
  filter: none;
}

.playhead-head {
  width: 2px;
  height: 20px;
  background: linear-gradient(180deg, #fff, var(--dm-accent));
  border-radius: 0 0 2px 2px;
  margin-left: -1px;
  position: relative;
}

.playhead-head::before {
  content: '';
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 6px solid #fff;
}

.playhead-line {
  width: 2px;
  height: calc(100vh - 20px);
  background: linear-gradient(180deg, var(--dm-accent) 0%, rgba(92, 255, 212, 0.8) 50%, rgba(92, 255, 212, 0.3) 100%);
  margin-left: -1px;
  box-shadow: none;
}

/* ============================================= 
   СТАТИСТИКА В TIME RULER
   ============================================= */

.time-ruler-stats {
  position: absolute;
  left: 8px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: row;
  gap: 6px;
  font-size: 8px;
  opacity: 0.55;
  pointer-events: none;
  z-index: 10;
}

.time-ruler-stats-clips,
.time-ruler-stats-duration {
  font-weight: 400;
  color: #DFFEF3;
  white-space: nowrap;
  letter-spacing: 0;
  line-height: 1.2;
}

.time-ruler-stats-duration {
  font-variant-numeric: tabular-nums;
}

/* ============================================= 
   АУДИО-ДОРОЖКА
   ============================================= */

.audio-track {
  display: flex;
  height: 32px;
  min-height: 32px;
  max-height: 32px;
  border-bottom: 1px solid var(--dm-track-border);
  position: relative;
  background: var(--dm-track-bg);
}

/* Тонкая дорожка (для переходов) */
.audio-track-thin {
  height: 24px;
  min-height: 24px;
  max-height: 24px;
}

.audio-track-thin .audio-track-label {
  height: 24px !important;
  min-height: 24px !important;
  max-height: 24px !important;
  line-height: 24px !important;
  font-size: 8px !important;
}

/* Вложенная дорожка (внутри группы) */
.audio-track-nested {
  background: rgba(0, 0, 0, 0.2);
  border-left: 2px solid rgba(44, 94, 78, 0.3);
  padding-left: 4px;
}

.audio-track-nested .audio-track-label {
  background: rgba(0, 0, 0, 0.3);
  font-size: 8px !important;
  padding-left: 8px !important;
  text-transform: none;
  font-weight: 500;
}

.audio-track-label {
  box-sizing: border-box !important;
  width: 76px !important;
  min-width: 76px !important;
  max-width: 76px !important;
  height: 32px !important;
  min-height: 32px !important;
  max-height: 32px !important;
  padding: 0 4px !important;
  margin: 0 !important;
  background: 
    linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, transparent 100%),
    linear-gradient(145deg, var(--dm-surface), var(--dm-bg-softer));
  border: 1px solid;
  border-color: 
    rgba(44, 94, 78, 0.2) 
    rgba(44, 94, 78, 0.25) 
    rgba(0, 0, 0, 0.5) 
    rgba(44, 94, 78, 0.15);
  border-left: none;
  font-size: 9px !important;
  line-height: 32px !important;
  color: rgba(255, 255, 255, 0.75);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  font-weight: 700;
  position: relative;
  box-shadow: 
    inset 0 1px 2px rgba(255, 255, 255, 0.05),
    inset 0 -2px 4px rgba(0, 0, 0, 0.3);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
  flex-shrink: 0 !important;
}

/* Текст внутри label - строго фиксированные параметры */
.audio-track-label > span {
  position: relative !important;
  z-index: 1 !important;
  font-size: 9px !important;
  line-height: 1 !important;
  display: inline !important;
  margin: 0 !important;
  padding: 0 !important;
  vertical-align: baseline !important;
}

.audio-track-label::before {
  /* Убрано - используем SVG иконку вместо эмодзи */
  display: none;
}

.audio-track-content {
  box-sizing: border-box;
  flex: 1;
  position: relative;
  background: 
    repeating-linear-gradient(
      90deg,
      transparent 0px,
      transparent 59px,
      rgba(44, 94, 78, 0.04) 59px,
      rgba(44, 94, 78, 0.04) 60px
    ),
    linear-gradient(180deg, rgba(0, 0, 0, 0.15) 0%, rgba(9, 28, 22, 0.4) 50%, rgba(0, 0, 0, 0.2) 100%);
  height: 32px;
  min-height: 32px;
  max-height: 32px;
  box-shadow: 
    inset 0 2px 6px rgba(0, 0, 0, 0.4),
    inset 0 -1px 2px rgba(0, 0, 0, 0.3);
  border-top: 1px solid rgba(0, 0, 0, 0.4);
  border-bottom: 1px solid rgba(255, 255, 255, 0.02);
}

/* ============================================= 
   АУДИО-КЛИП
   ============================================= */

.audio-clip-item {
  position: absolute;
  top: 7px;
  height: 18px;
  background: 
    linear-gradient(180deg, rgba(255, 255, 255, 0.04) 0%, transparent 50%, rgba(0, 0, 0, 0.2) 100%),
    linear-gradient(135deg, #1a1626, #14121e);
  border: 1.5px solid;
  border-color: 
    rgba(44, 94, 78, 0.4) 
    rgba(44, 94, 78, 0.25) 
    rgba(0, 0, 0, 0.6) 
    rgba(44, 94, 78, 0.35);
  border-radius: 8px;
  cursor: move;
  user-select: none;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden;
  box-shadow: 
    0 4px 12px rgba(0, 0, 0, 0.5),
    0 2px 4px rgba(0, 0, 0, 0.7),
    inset 0 1px 2px rgba(255, 255, 255, 0.08),
    inset 0 -2px 4px rgba(0, 0, 0, 0.3);
  position: relative;
}

/* Waveform визуализация - как в Audition/Reaper */
.audio-clip-item::after {
  content: '';
  position: absolute;
  inset: 0;
  background-image: 
    /* Первая волна - очень громко */
    linear-gradient(180deg, transparent 8%, rgba(44, 94, 78, 0.55) 28%, rgba(44, 94, 78, 0.6) 50%, rgba(44, 94, 78, 0.55) 72%, transparent 92%),
    /* Вторая - громко */
    linear-gradient(180deg, transparent 15%, rgba(44, 94, 78, 0.5) 35%, rgba(44, 94, 78, 0.55) 50%, rgba(44, 94, 78, 0.5) 65%, transparent 85%),
    /* Третья - громко */
    linear-gradient(180deg, transparent 12%, rgba(44, 94, 78, 0.52) 32%, rgba(44, 94, 78, 0.57) 50%, rgba(44, 94, 78, 0.52) 68%, transparent 88%),
    /* Четвертая - средне */
    linear-gradient(180deg, transparent 28%, rgba(44, 94, 78, 0.42) 44%, rgba(44, 94, 78, 0.45) 50%, rgba(44, 94, 78, 0.42) 56%, transparent 72%),
    /* Пятая - средне-тихо */
    linear-gradient(180deg, transparent 35%, rgba(44, 94, 78, 0.35) 46%, rgba(44, 94, 78, 0.38) 50%, rgba(44, 94, 78, 0.35) 54%, transparent 65%),
    /* Шестая - тихо */
    linear-gradient(180deg, transparent 40%, rgba(44, 94, 78, 0.28) 47%, rgba(44, 94, 78, 0.3) 50%, rgba(44, 94, 78, 0.28) 53%, transparent 60%),
    /* Седьмая - средне */
    linear-gradient(180deg, transparent 30%, rgba(44, 94, 78, 0.4) 45%, rgba(44, 94, 78, 0.43) 50%, rgba(44, 94, 78, 0.4) 55%, transparent 70%),
    /* Восьмая - громко */
    linear-gradient(180deg, transparent 18%, rgba(44, 94, 78, 0.48) 38%, rgba(44, 94, 78, 0.52) 50%, rgba(44, 94, 78, 0.48) 62%, transparent 82%),
    /* Девятая - очень громко */
    linear-gradient(180deg, transparent 5%, rgba(44, 94, 78, 0.58) 25%, rgba(44, 94, 78, 0.63) 50%, rgba(44, 94, 78, 0.58) 75%, transparent 95%),
    /* Десятая - средне-громко */
    linear-gradient(180deg, transparent 22%, rgba(44, 94, 78, 0.45) 40%, rgba(44, 94, 78, 0.48) 50%, rgba(44, 94, 78, 0.45) 60%, transparent 78%),
    /* Одиннадцатая - тихо */
    linear-gradient(180deg, transparent 42%, rgba(44, 94, 78, 0.25) 48%, rgba(44, 94, 78, 0.27) 50%, rgba(44, 94, 78, 0.25) 52%, transparent 58%),
    /* Двенадцатая - очень тихо */
    linear-gradient(180deg, transparent 45%, rgba(44, 94, 78, 0.2) 49%, rgba(44, 94, 78, 0.22) 50%, rgba(44, 94, 78, 0.2) 51%, transparent 55%),
    /* Тринадцатая - средне */
    linear-gradient(180deg, transparent 32%, rgba(44, 94, 78, 0.38) 45%, rgba(44, 94, 78, 0.4) 50%, rgba(44, 94, 78, 0.38) 55%, transparent 68%),
    /* Четырнадцатая - громко */
    linear-gradient(180deg, transparent 14%, rgba(44, 94, 78, 0.5) 34%, rgba(44, 94, 78, 0.54) 50%, rgba(44, 94, 78, 0.5) 66%, transparent 86%),
    /* Пятнадцатая - средне-тихо */
    linear-gradient(180deg, transparent 38%, rgba(44, 94, 78, 0.32) 47%, rgba(44, 94, 78, 0.34) 50%, rgba(44, 94, 78, 0.32) 53%, transparent 62%),
    /* Шестнадцатая - тихо */
    linear-gradient(180deg, transparent 43%, rgba(44, 94, 78, 0.24) 48%, rgba(44, 94, 78, 0.26) 50%, rgba(44, 94, 78, 0.24) 52%, transparent 57%),
    /* Семнадцатая - средне */
    linear-gradient(180deg, transparent 26%, rgba(44, 94, 78, 0.43) 43%, rgba(44, 94, 78, 0.46) 50%, rgba(44, 94, 78, 0.43) 57%, transparent 74%),
    /* Восемнадцатая - громко */
    linear-gradient(180deg, transparent 10%, rgba(44, 94, 78, 0.53) 30%, rgba(44, 94, 78, 0.58) 50%, rgba(44, 94, 78, 0.53) 70%, transparent 90%),
    /* Девятнадцатая - средне-громко */
    linear-gradient(180deg, transparent 20%, rgba(44, 94, 78, 0.47) 39%, rgba(44, 94, 78, 0.5) 50%, rgba(44, 94, 78, 0.47) 61%, transparent 80%),
    /* Двадцатая - тихо */
    linear-gradient(180deg, transparent 41%, rgba(44, 94, 78, 0.27) 47%, rgba(44, 94, 78, 0.29) 50%, rgba(44, 94, 78, 0.27) 53%, transparent 59%);
  background-size: 
    2px 100%, 2px 100%, 2px 100%, 2px 100%, 2px 100%,
    2px 100%, 2px 100%, 2px 100%, 2px 100%, 2px 100%,
    2px 100%, 2px 100%, 2px 100%, 2px 100%, 2px 100%,
    2px 100%, 2px 100%, 2px 100%, 2px 100%, 2px 100%;
  background-position: 
    1px center, 4px center, 7px center, 10px center, 13px center,
    16px center, 19px center, 22px center, 25px center, 28px center,
    31px center, 34px center, 37px center, 40px center, 43px center,
    46px center, 49px center, 52px center, 55px center, 58px center;
  background-repeat: repeat-x;
  opacity: 0.9;
  pointer-events: none;
  z-index: 1;
}

.audio-clip-item:hover {
  border-color: 
    rgba(44, 94, 78, 0.5) 
    rgba(44, 94, 78, 0.3) 
    rgba(0, 0, 0, 0.7) 
    rgba(44, 94, 78, 0.4);
  transform: translateY(-1px);
  box-shadow: 
    0 5px 14px rgba(0, 0, 0, 0.6),
    0 2px 5px rgba(44, 94, 78, 0.3),
    inset 0 1px 2px rgba(255, 255, 255, 0.1),
    inset 0 -2px 4px rgba(0, 0, 0, 0.35);
}

.audio-clip-item.selected {
  border-color: 
    rgba(44, 94, 78, 0.6) 
    rgba(44, 94, 78, 0.4) 
    rgba(0, 0, 0, 0.8) 
    rgba(44, 94, 78, 0.5);
  box-shadow: 
    0 5px 18px rgba(0, 0, 0, 0.6),
    0 2px 6px rgba(0, 0, 0, 0.8),
    inset 0 1px 2px rgba(255, 255, 255, 0.12),
    inset 0 -2px 5px rgba(0, 0, 0, 0.4);
  background: 
    linear-gradient(180deg, rgba(255, 255, 255, 0.05) 0%, transparent 50%, rgba(0, 0, 0, 0.25) 100%),
    linear-gradient(135deg, #1e1a2a, #161420);
}

.audio-clip-item.selected::after {
  opacity: 0.8;
}

.audio-clip-item.dragging {
  opacity: 0.7;
  cursor: grabbing;
}

.clip-content {
  padding: 8px;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  position: relative;
  z-index: 2;
}

.clip-name {
  font-size: 11px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.9);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-shadow: 
    0 1px 2px rgba(0, 0, 0, 0.8),
    0 0 4px rgba(0, 0, 0, 0.5);
  letter-spacing: 0.02em;
}

.clip-icons {
  display: flex;
  gap: 5px;
  font-size: 12px;
  align-items: center;
}

.clip-icon {
  opacity: 0.85;
  filter: none;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.clip-icon:hover {
  opacity: 1;
  transform: scale(1.15);
}

.clip-icon.premium {
  color: #ffd700;
  animation: premiumPulse 2s ease-in-out infinite;
}

@keyframes premiumPulse {
  0%, 100% {
    transform: scale(1);
    opacity: 0.85;
  }
  50% {
    transform: scale(1.1);
    opacity: 1;
  }
}

.clip-delete-btn {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 22px;
  height: 22px;
  background: rgba(220, 53, 69, 0.9);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 5px;
  color: #fff;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
}

.clip-delete-btn:hover {
  background: rgba(220, 53, 69, 1);
  transform: scale(1.15);
  box-shadow: 0 3px 10px rgba(220, 53, 69, 0.5);
}

.clip-delete-btn:active {
  transform: scale(1.05);
}

/* Trim handles */
.clip-trim-handle {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 10px;
  background: linear-gradient(90deg, rgba(92, 255, 212, 0.6), rgba(92, 255, 212, 0.4));
  cursor: ew-resize;
  z-index: 3;
  opacity: 0;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  border: 1px solid rgba(92, 255, 212, 0.3);
}

.clip-trim-handle::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 2px;
  height: 16px;
  background: rgba(255, 255, 255, 0.5);
  border-radius: 1px;
}

.audio-clip-item:hover .clip-trim-handle,
.audio-clip-item.selected .clip-trim-handle {
  opacity: 1;
}

.clip-trim-start {
  left: 0;
  border-top-left-radius: 6px;
  border-bottom-left-radius: 6px;
  background: linear-gradient(90deg, rgba(92, 255, 212, 0.7), rgba(92, 255, 212, 0.4));
}

.clip-trim-end {
  right: 0;
  border-top-right-radius: 6px;
  border-bottom-right-radius: 6px;
  background: linear-gradient(90deg, rgba(92, 255, 212, 0.4), rgba(92, 255, 212, 0.7));
}

.clip-trim-handle:hover {
  background: rgba(92, 255, 212, 0.9);
  width: 12px;
}

/* Fade индикаторы */
.clip-fade {
  position: absolute;
  top: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 1;
}

.clip-fade-in {
  left: 0;
  background: linear-gradient(
    to right, 
    rgba(76, 175, 80, 0.15), 
    rgba(76, 175, 80, 0.08) 50%,
    transparent
  );
  border-left: 2px solid rgba(76, 175, 80, 0.4);
}

.clip-fade-out {
  right: 0;
  background: linear-gradient(
    to left, 
    rgba(255, 87, 34, 0.15), 
    rgba(255, 87, 34, 0.08) 50%,
    transparent
  );
  border-right: 2px solid rgba(255, 87, 34, 0.4);
}

/* ============================================= 
   ПАНЕЛЬ РЕДАКТИРОВАНИЯ КЛИПА
   ============================================= */

.timeline-editor-panel {
  width: 280px;
  background: rgba(15, 12, 20, 0.95);
  border-left: 1px solid rgba(44, 94, 78, 0.2);
  overflow-y: auto;
  position: relative;
}

.timeline-editor-close {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 24px;
  height: 24px;
  background: rgba(44, 94, 78, 0.2);
  border: 1px solid rgba(44, 94, 78, 0.3);
  border-radius: 4px;
  color: #fff;
  font-size: 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  z-index: 10;
}

.timeline-editor-close:hover {
  background: rgba(220, 53, 69, 0.8);
}

.audio-clip-editor {
  padding: 16px;
}

.audio-clip-editor-empty {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: rgba(255, 255, 255, 0.5);
  font-size: 12px;
}

.clip-editor-header h4 {
  margin: 0 0 16px 0;
  font-size: 14px;
  color: #fff;
  font-weight: 600;
}

.clip-editor-section {
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid rgba(44, 94, 78, 0.15);
}

.clip-editor-section:last-child {
  border-bottom: none;
}

.clip-editor-section h5 {
  margin: 0 0 12px 0;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.6);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}

.premium-badge {
  font-size: 9px;
  padding: 2px 6px;
  background: linear-gradient(135deg, #ffd700, #ffed4e);
  color: #000;
  border-radius: 4px;
  font-weight: 700;
}

.clip-editor-control {
  margin-bottom: 12px;
}

.clip-editor-control label {
  display: block;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 6px;
}

.clip-editor-control input[type="range"] {
  width: 100%;
  height: 4px;
  background: rgba(44, 94, 78, 0.2);
  border-radius: 2px;
  outline: none;
  appearance: none;
}

.clip-editor-control input[type="range"]::-webkit-slider-thumb {
  appearance: none;
  width: 14px;
  height: 14px;
  background: var(--dm-accent);
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 0 4px rgba(92, 255, 212, 0.6);
}

.clip-editor-control input[type="range"]::-moz-range-thumb {
  width: 14px;
  height: 14px;
  background: var(--dm-accent);
  border-radius: 50%;
  cursor: pointer;
  border: none;
  box-shadow: 0 0 4px rgba(92, 255, 212, 0.6);
}

.clip-editor-control select {
  width: 100%;
  padding: 6px 8px;
  background: rgba(44, 94, 78, 0.1);
  border: 1px solid rgba(44, 94, 78, 0.3);
  border-radius: 4px;
  color: #fff;
  font-size: 11px;
  cursor: pointer;
}

.clip-editor-control select:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.clip-editor-checkbox {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.clip-editor-checkbox input[type="checkbox"] {
  width: 16px;
  height: 16px;
  cursor: pointer;
}

.clip-editor-buttons {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.clip-editor-btn {
  flex: 1;
  padding: 6px 12px;
  background: rgba(44, 94, 78, 0.1);
  border: 1px solid rgba(44, 94, 78, 0.3);
  border-radius: 4px;
  color: rgba(255, 255, 255, 0.8);
  font-size: 11px;
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 500;
}

.clip-editor-btn:hover {
  background: rgba(44, 94, 78, 0.2);
  border-color: rgba(44, 94, 78, 0.5);
}

.clip-editor-btn.active {
  background: rgba(92, 255, 212, 0.4);
  border-color: var(--dm-accent);
  color: #fff;
}

/* Премиум-секция */
.clip-editor-premium.locked {
  position: relative;
  opacity: 0.6;
}

.clip-editor-premium.locked::after {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(2px);
  border-radius: 4px;
  pointer-events: none;
}

.premium-cta {
  margin-top: 12px;
  position: relative;
  z-index: 2;
}

.premium-cta-btn {
  width: 100%;
  padding: 10px;
  background: linear-gradient(135deg, #ffd700, #ffed4e);
  border: none;
  border-radius: 6px;
  color: #000;
  font-size: 12px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.premium-cta-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
}

/* ============================================= 
   АНИМАЦИИ ДЛЯ ИКОНОК (МЯГКИЕ, БЕЗ СВЕТА НА КНОПКАХ)
   ============================================= */

.timeline-header-icon {
  /* Лёгкая жизнь заголовка, без влияния на кнопки */
  animation: headerPulse 3s ease-in-out infinite;
}

@keyframes headerPulse {
  0%, 100% { opacity: 0.9; transform: translateY(0); }
  50%      { opacity: 1;   transform: translateY(-1px); }
}

.clip-icon.premium {
  animation: premiumPulse 2.4s ease-in-out infinite;
}

@keyframes premiumPulse {
  0%, 100% { transform: scale(1); }
  50%      { transform: scale(1.08); }
}

/* ============================================= 
   ГРУППА ВИЗУАЛЬНЫХ СЛОЕВ (Сворачиваемая)
   ============================================= */

.timeline-group-track {
  border-bottom: 1px solid var(--dm-track-border);
  background: var(--dm-track-bg);
  position: relative;
}

/* Визуальный контейнер СЦЕНЫ */
.timeline-group-track--scene {
  position: relative;
}

.timeline-group-scene-container {
  position: relative;
}

/* Фоновая полоса для всех слоёв СЦЕНЫ (опционально, для визуальной группировки) */
.timeline-group-scene-container .timeline-group-content {
  position: relative;
  background: rgba(44, 94, 78, 0.03);
  margin-left: 0;
}

.timeline-group-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 32px;
  min-height: 32px;
  padding: 0 8px;
  cursor: pointer;
  user-select: none;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.02) 0%, transparent 100%);
  border-bottom: 1px solid rgba(44, 94, 78, 0.2);
  transition: background 0.2s;
}

.timeline-group-header:hover {
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.04) 0%, rgba(255, 255, 255, 0.01) 100%);
}

.timeline-group-header-left {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
}

.timeline-group-chevron {
  width: 16px;
  height: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: rgba(255, 255, 255, 0.6);
  transition: transform 0.2s, color 0.2s;
  flex-shrink: 0;
}

.timeline-group-chevron.expanded {
  transform: rotate(90deg);
}

.timeline-group-header:hover .timeline-group-chevron {
  color: rgba(255, 255, 255, 0.8);
}

.timeline-group-title {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: rgba(255, 255, 255, 0.85);
}

.timeline-group-count {
  font-size: 9px;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.5);
  margin-left: 4px;
}

.timeline-group-header-right {
  display: flex;
  align-items: center;
  gap: 8px;
}

.timeline-group-content {
  background: rgba(0, 0, 0, 0.15);
  border-top: 1px solid rgba(44, 94, 78, 0.1);
}

.timeline-group-nested-track {
  background: rgba(0, 0, 0, 0.2);
  border-left: 2px solid rgba(44, 94, 78, 0.3);
}

.timeline-group-nested-track .audio-track {
  background: rgba(0, 0, 0, 0.2);
}

.timeline-group-nested-track .audio-track-label {
  background: rgba(0, 0, 0, 0.3);
  font-size: 8px !important;
  padding-left: 8px !important;
  text-transform: none;
  font-weight: 500;
}

/* ============================================= 
   СТРОКИ СЛОЕВ ВНУТРИ СЦЕНЫ
   ============================================= */

.visual-layer-row {
  display: flex;
  height: 28px;
  min-height: 28px;
  border-bottom: 1px solid rgba(44, 94, 78, 0.15);
  background: rgba(0, 0, 0, 0.2);
  cursor: pointer;
  transition: background 0.15s;
  position: relative;
}

.visual-layer-row:hover {
  background: rgba(44, 94, 78, 0.1);
}

.visual-layer-row-selected {
  background: rgba(44, 94, 78, 0.2);
  border-left: 2px solid rgba(92, 255, 212, 0.6);
}

.visual-layer-row-selected:hover {
  background: rgba(44, 94, 78, 0.25);
}

.visual-layer-row-label {
  display: flex;
  align-items: center;
  gap: 6px;
  width: 240px;
  min-width: 240px;
  max-width: 240px;
  padding: 0 10px;
  background: rgba(0, 0, 0, 0.3);
  border-right: 1px solid rgba(44, 94, 78, 0.3);
  flex-shrink: 0;
  position: relative;
}

.visual-layer-row-icon {
  width: 16px;
  height: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  color: rgba(255, 255, 255, 0.7);
}

.visual-layer-row-name {
  flex: 1;
  font-size: 10px;
  color: rgba(255, 255, 255, 0.8);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 500;
  min-width: 0;
}

.visual-layer-row-badge {
  display: inline-flex;
  align-items: center;
  padding: 2px 6px;
  font-size: 8px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.5);
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 3px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  flex-shrink: 0;
}

.visual-layer-row-actions {
  display: flex;
  align-items: center;
  gap: 4px;
  flex-shrink: 0;
  margin-left: auto;
  opacity: 0.6;
  transition: opacity 0.15s;
}

.visual-layer-row:hover .visual-layer-row-actions {
  opacity: 1;
}

.visual-layer-action-btn {
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  color: rgba(255, 255, 255, 0.5);
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.15s;
  padding: 0;
}

.visual-layer-action-btn:hover {
  background: rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.8);
}

.visual-layer-action-btn-hidden {
  color: rgba(255, 255, 255, 0.3);
}

.visual-layer-action-btn-locked {
  color: rgba(92, 255, 212, 0.6);
}

.visual-layer-row-content {
  flex: 1;
  position: relative;
  overflow: hidden;
  background: rgba(0, 0, 0, 0.1);
  /* КРИТИЧНО: никаких отступов - клипы должны начинаться строго с left: 0 */
  margin: 0;
  padding: 0;
  border: none;
  /* КРИТИЧНО: transform-origin должен быть слева, чтобы трансформации родителя не сдвигали начало */
  transform-origin: left center;
  /* КРИТИЧНО: компенсируем разницу между шириной label (240px) и LEFT_OFFSET (80px) */
  /* Чтобы клипы начинались с 0:00, нужно сдвинуть контейнер влево на 160px */
  margin-left: -160px;
  padding-left: 160px;
}

.visual-layer-clip {
  position: absolute;
  top: 2px;
  bottom: 2px;
  /* left задается через inline style в компоненте */
  background: rgba(92, 255, 212, 0.3);
  border: 1px solid rgba(92, 255, 212, 0.5);
  border-radius: 2px;
  min-width: 20px;
  cursor: pointer;
  transition: background 0.15s;
  display: flex;
  align-items: center;
  /* padding только справа, чтобы не смещать левый край клипа */
  padding-left: 0;
  padding-right: 4px;
  gap: 4px;
  /* Геометрия: левый край клипа = начало сцены (0:00) */
  /* КРИТИЧНО: transform-origin слева, чтобы зум не сдвигал начало */
  transform-origin: left center;
}

.visual-layer-row:hover .visual-layer-clip {
  background: rgba(92, 255, 212, 0.4);
  border-color: rgba(92, 255, 212, 0.7);
}

.visual-layer-row-selected .visual-layer-clip {
  background: rgba(92, 255, 212, 0.5);
  border-color: rgba(92, 255, 212, 0.9);
  box-shadow: 0 0 4px rgba(92, 255, 212, 0.3);
}

.visual-layer-clip-actions {
  display: flex;
  align-items: center;
  gap: 4px;
  opacity: 0.7;
  transition: opacity 0.15s;
  position: absolute;
  left: 4px;
  top: 50%;
  transform: translateY(-50%);
  z-index: 10;
}

.visual-layer-row:hover .visual-layer-clip-actions {
  opacity: 1;
}

.visual-layer-clip-actions .visual-layer-action-btn {
  width: 18px;
  height: 18px;
  padding: 0;
  background: rgba(0, 0, 0, 0.4);
  border-radius: 3px;
  backdrop-filter: blur(4px);
}

.visual-layer-clip-actions .visual-layer-action-btn:hover {
  background: rgba(0, 0, 0, 0.6);
}

/* Тонкая дорожка (для переходов) */
.audio-track-thin {
  height: 24px;
  min-height: 24px;
  max-height: 24px;
}

.audio-track-thin .audio-track-label {
  height: 24px !important;
  min-height: 24px !important;
  max-height: 24px !important;
  line-height: 24px !important;
  font-size: 8px !important;
}

/* Вложенная дорожка (внутри группы) */
.audio-track-nested {
  background: rgba(0, 0, 0, 0.2);
  border-left: 2px solid rgba(44, 94, 78, 0.3);
  padding-left: 4px;
}

.audio-track-nested .audio-track-label {
  background: rgba(0, 0, 0, 0.3);
  font-size: 8px !important;
  padding-left: 8px !important;
  text-transform: none;
  font-weight: 500;
}

